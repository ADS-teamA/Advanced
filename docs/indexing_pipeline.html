<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUJBOT2 - Indexing Pipeline (F√°ze 1-5)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.8em;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            margin-bottom: 30px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .back-button::before {
            content: '‚Üê';
            font-size: 1.3em;
        }

        .pipeline {
            display: flex;
            flex-direction: column;
            gap: 40px;
            position: relative;
        }

        .phase {
            background: linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%);
            border-radius: 20px;
            padding: 30px;
            border-left: 8px solid #667eea;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .phase:hover {
            transform: translateX(15px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.25);
            border-left-color: #764ba2;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .phase-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 2em;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .phase-title {
            font-size: 2em;
            color: #2d3748;
            font-weight: 700;
            flex: 1;
        }

        .phase-timing {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .phase-content {
            margin-left: 90px;
        }

        .phase-description {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .phase-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            background: white;
            padding: 18px 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .detail-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .detail-label {
            font-size: 0.85em;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .detail-value {
            color: #2d3748;
            font-weight: 600;
            font-size: 1.05em;
        }

        .detail-code {
            font-family: 'Courier New', monospace;
            background: #f7fafc;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #e53e3e;
        }

        .sub-phases {
            margin-top: 25px;
            padding-left: 25px;
            border-left: 4px solid #cbd5e0;
        }

        .sub-phase {
            padding: 20px 25px;
            margin-bottom: 15px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .sub-phase:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .sub-phase-title {
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .sub-phase-desc {
            font-size: 1em;
            color: #718096;
            line-height: 1.6;
        }

        .arrow {
            text-align: center;
            font-size: 3em;
            color: #cbd5e0;
            margin: -15px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .highlight {
            background: #fef5e7;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 700;
            color: #d97706;
        }

        .tag {
            display: inline-block;
            background: #e6f2ff;
            color: #2563eb;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 0.9em;
            margin-right: 10px;
            margin-top: 10px;
            font-weight: 600;
        }

        .tag.research {
            background: #fef3c7;
            color: #d97706;
        }

        .tag.performance {
            background: #d1fae5;
            color: #059669;
        }

        .data-flow {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .data-flow-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .data-flow-content {
            color: #4a5568;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .research-note {
            background: linear-gradient(135deg, #fef5e7 0%, #fef3c7 100%);
            border-left: 4px solid #d97706;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .research-note-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .research-note-content {
            color: #78350f;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-top: 50px;
            padding-top: 40px;
            border-top: 3px solid #e2e8f0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.95;
        }

        @media (max-width: 768px) {
            .phase-details {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
            }

            .phase-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">Back to Home</a>
        <h1>üì• SUJBOT2 Indexing Pipeline</h1>
        <p class="subtitle">F√°ze 1-5: Od dokumentu k prohled√°vateln√©mu vektorov√©mu indexu (SOTA RAG 2025)</p>

        <div class="pipeline">
            <!-- PHASE 1 -->
            <div class="phase">
                <div class="phase-header">
                    <div class="phase-number">1</div>
                    <div class="phase-title">Hierarchy Extraction</div>
                    <div class="phase-timing">~30-60s</div>
                </div>
                <div class="phase-content">
                    <div class="phase-description">
                        <strong>√ökol:</strong> Extrahovat hierarchickou strukturu dokumentu (kapitoly, sekce, podsekce) pomoc√≠ IBM Docling, kter√© pou≈æ√≠v√° pokroƒçilou klasifikaci podle velikosti fontu a layoutu str√°nky.
                    </div>
                    <div class="phase-details">
                        <div class="detail-item">
                            <div class="detail-label">üõ†Ô∏è N√°stroj</div>
                            <div class="detail-value">IBM Docling (open-source)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìä V√Ωstup</div>
                            <div class="detail-value">JSON hierarchie (depth=4)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üéØ Metoda</div>
                            <div class="detail-value">Font-size classification + layout analysis</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìÑ Implementace</div>
                            <div class="detail-value"><span class="detail-code">src/docling_extractor_v2.py</span></div>
                        </div>
                    </div>

                    <div class="data-flow">
                        <div class="data-flow-title">üì¶ Datov√Ω tok:</div>
                        <div class="data-flow-content">
PDF/DOCX ‚Üí Docling Parser ‚Üí Hierarchie (JSON):<br>
{<br>
&nbsp;&nbsp;"doc_id": "document_name",<br>
&nbsp;&nbsp;"sections": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;{"id": "1", "title": "Kapitola 1", "level": 1, "content": "...", "subsections": [...]}<br>
&nbsp;&nbsp;]<br>
}
                        </div>
                    </div>

                    <span class="tag">Podporuje PDF, DOCX, HTML</span>
                    <span class="tag performance">Hloubka: 4 √∫rovnƒõ</span>
                </div>
            </div>

            <div class="arrow">‚Üì</div>

            <!-- PHASE 2 -->
            <div class="phase">
                <div class="phase-header">
                    <div class="phase-number">2</div>
                    <div class="phase-title">Summary Generation</div>
                    <div class="phase-timing">Fast: ~1-2min | Eco: ~15-30min</div>
                </div>
                <div class="phase-content">
                    <div class="phase-description">
                        <strong>√ökol:</strong> Vygenerovat <span class="highlight">GENERIC</span> shrnut√≠ pro cel√Ω dokument a ka≈ædou sekci (150 znak≈Ø). <br>
                        <strong>Hierarchick√Ω proces:</strong> Nejd≈ô√≠v se vygeneruj√≠ section summaries (150 chars ka≈æd√°), pak se z nich slo≈æ√≠ document summary (tak√© 150 chars). Tyto shrnut√≠ se pak pou≈æij√≠ jako kontext v SAC (Phase 3).
                    </div>
                    <div class="phase-details">
                        <div class="detail-item">
                            <div class="detail-label">ü§ñ Model (Fast)</div>
                            <div class="detail-value">gpt-5-nano / gpt-4o-mini</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üí∞ Model (Eco)</div>
                            <div class="detail-value">OpenAI Batch API (50% levnƒõj≈°√≠)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìè Section summary</div>
                            <div class="detail-value">150 znak≈Ø (ka≈æd√° sekce)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìè Document summary</div>
                            <div class="detail-value">150 znak≈Ø (ze section summaries)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üîÑ Proces</div>
                            <div class="detail-value">Bottom-up hierarchical (sections ‚Üí document)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üé® Styl</div>
                            <div class="detail-value"><strong>GENERIC</strong> (NOT expert!)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìÑ Implementace</div>
                            <div class="detail-value"><span class="detail-code">src/summary_generator.py</span></div>
                        </div>
                    </div>

                    <div class="research-note">
                        <div class="research-note-title">üî¨ Research-backed design (Reuter et al., 2024):</div>
                        <div class="research-note-content">
                            <strong>Counterintuitive finding:</strong> GENERIC summaries funguj√≠ l√©pe ne≈æ expert summaries!<br>
                            ‚Ä¢ Expert shrnut√≠: "ƒål√°nek 12 stanovuje sankce dle na≈ô√≠zen√≠ 2023/1234..."<br>
                            ‚Ä¢ Generic shrnut√≠: "Dokument popisuje pravidla a sankce..."<br>
                            <br>
                            <strong>Proƒç?</strong> Generic terminologie m√° lep≈°√≠ s√©mantickou shodu s bƒõ≈æn√Ωmi user dotazy, kter√© nepou≈æ√≠vaj√≠ pr√°vn√≠ ≈æargon.<br>
                            <br>
                            <strong>Hierarchick√° generace:</strong> Document summary se vytv√°≈ô√≠ z ji≈æ vygenerovan√Ωch section summaries (bottom-up p≈ô√≠stup) ‚Üí ≈æ√°dn√© truncation, pokryt√≠ cel√©ho dokumentu bez omezen√≠ velikosti.
                        </div>
                    </div>

                    <div class="data-flow">
                        <div class="data-flow-title">üì¶ Datov√Ω tok (hierarchick√Ω bottom-up):</div>
                        <div class="data-flow-content">
<strong>KROK 1:</strong> Hierarchie + LLM ‚Üí Ka≈æd√° sekce dostane 150-char generic summary:<br>
{<br>
&nbsp;&nbsp;"section_id": "1.2",<br>
&nbsp;&nbsp;"content": "Tento paragraf stanovuje...",<br>
&nbsp;&nbsp;"summary": "Pravidla pro registraci..." (150 chars)<br>
}<br>
<br>
<strong>KROK 2:</strong> Section summaries ‚Üí Document summary (150 chars):<br>
Section summaries: ["Pravidla pro registraci...", "Sankce za poru≈°en√≠...", ...]<br>
‚Üì LLM synt√©za ‚Üì<br>
Document summary: "Dokument popisuje pravidla a sankce..." (150 chars)<br>
<br>
‚Üí <strong>V√Ωhoda:</strong> ≈Ω√°dn√© truncation, pokryt√≠ cel√©ho dokumentu bez ohledu na velikost!
                        </div>
                    </div>

                    <span class="tag research">Research-backed</span>
                    <span class="tag">Generic > Expert</span>
                    <span class="tag performance">150 chars optimum</span>
                    <span class="tag performance">Hierarchical bottom-up</span>
                </div>
            </div>

            <div class="arrow">‚Üì</div>

            <!-- PHASE 3 -->
            <div class="phase">
                <div class="phase-header">
                    <div class="phase-number">3</div>
                    <div class="phase-title">Multi-Layer Chunking + Contextual Retrieval</div>
                    <div class="phase-timing">~10-20s (chunking) + ~2-5min (context gen)</div>
                </div>
                <div class="phase-content">
                    <div class="phase-description">
                        <strong>√ökol:</strong> Rozdƒõlit dokument do 3 vrstev pomoc√≠ RCTS metody a p≈ôidat bohat√Ω context k chunks pomoc√≠ <span class="highlight">Contextual Retrieval</span> (Anthropic 2024), co≈æ sni≈æuje retrieval failures o 67%.<br>
                        <strong>Hybrid p≈ô√≠stup:</strong> Kombinuje SAC koncept (document summary z Phase 2) s pokroƒçil√Ωm LLM-generated chunk-specific contextem.
                    </div>
                    <div class="phase-details">
                        <div class="detail-item">
                            <div class="detail-label">üìê Metoda</div>
                            <div class="detail-value">RCTS (Recursive Character Text Splitting)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìè Chunk size</div>
                            <div class="detail-value"><strong>500 znak≈Ø</strong> (optim√°ln√≠ pro pr√°vn√≠/tech docs)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üîó Overlap</div>
                            <div class="detail-value">0 (RCTS ≈ôe≈°√≠ p≈ôirozenƒõ via hierarchii)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üèóÔ∏è Vrstvy</div>
                            <div class="detail-value">L1 (Document), L2 (Section), L3 (Chunk - PRIMARY)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">‚ú® Contextual Retrieval benefit</div>
                            <div class="detail-value">-67% retrieval failures (Anthropic)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üéØ Context length</div>
                            <div class="detail-value">50-100 slov (LLM-generated per chunk)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìÑ Implementace</div>
                            <div class="detail-value"><span class="detail-code">src/multi_layer_chunker.py</span></div>
                        </div>
                    </div>

                    <div class="research-note">
                        <div class="research-note-title">üî¨ Multi-Layer Chunking + Contextual Retrieval (Lima 2024 + Anthropic 2024 + Reuter 2024):</div>
                        <div class="research-note-content">
                            <strong>1. RCTS > Fixed-size chunking:</strong> RCTS respektuje s√©mantick√© hranice (vƒõty, odstavce) m√≠sto pevn√Ωch 500 znak≈Ø.<br>
                            <br>
                            <strong>2. Multi-layer indexing:</strong> 3 separ√°tn√≠ indexy p≈ôin√°≈°ej√≠ 2.3x v√≠ce relevantn√≠ch chunk≈Ø:<br>
                            ‚Ä¢ L1 (Document level): Pro high-level dotazy ("Co ≈ô√≠k√° z√°kon X?")<br>
                            ‚Ä¢ L2 (Section level): Pro st≈ôedn√≠ granularitu ("Pravidla pro registraci?")<br>
                            ‚Ä¢ L3 (Chunk level): Pro detailn√≠ dotazy ("Specifick√° sankce za X?")<br>
                            <br>
                            <strong>3. Contextual Retrieval (Anthropic 2024):</strong> LLM generuje chunk-specific context (50-100 slov) pro ka≈æd√Ω chunk:<br>
                            <br>
                            <strong>üì• Vstupy pro context generaci (per chunk):</strong><br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Document summary</strong> (150 chars z Phase 2) ‚Üí glob√°ln√≠ kontext<br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Section hierarchy</strong> (nap≈ô. "1.2.3 Sankce za poru≈°en√≠") ‚Üí pozice v dokumentu<br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Preceding chunk</strong> (p≈ôedchoz√≠ 500 chars) ‚Üí kontext "co bylo p≈ôed"<br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Following chunk</strong> (n√°sleduj√≠c√≠ 500 chars) ‚Üí kontext "co bude po"<br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Raw chunk</strong> (500 chars) ‚Üí samotn√Ω obsah<br>
                            <br>
                            <strong>ü§ñ LLM prompt:</strong><br>
                            <em>"Give a short succinct context (50-100 words) to situate this chunk within the overall document for improving search retrieval."</em><br>
                            <br>
                            <strong>üì§ V√Ωstup:</strong><br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Generated context</strong> (50-100 slov) - vysvƒõtluje, CO chunk diskutuje v r√°mci cel√©ho dokumentu<br>
                            <br>
                            <strong>üíæ Embedding & Storage:</strong><br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Embedding:</strong> <code>generated_context + "\n\n" + raw_chunk</code><br>
                            &nbsp;&nbsp;‚Ä¢ <strong>Storage:</strong> pouze <code>raw_chunk</code> (context se stripne p≈ôi retrievalu)<br>
                            <br>
                            <strong>‚ú® V√Ωsledek:</strong> Chunk "v√≠", o ƒçem je cel√Ω dokument + kde v nƒõm se nach√°z√≠ + co je okolo ‚Üí <strong>-67% retrieval failures</strong> (Anthropic research)
                        </div>
                    </div>

                    <div class="data-flow">
                        <div class="data-flow-title">üì¶ Datov√Ω tok (Contextual Retrieval):</div>
                        <div class="data-flow-content">
<strong>1. RCTS Chunking:</strong><br>
Sekce "1.2.3 Sankce za poru≈°en√≠" ‚Üí RCTS (500 chars) ‚Üí raw chunks<br>
<br>
<strong>2. Context Generation (per chunk):</strong><br>
Inputs ‚Üí LLM:<br>
&nbsp;&nbsp;‚Ä¢ Doc summary: "Dokument popisuje pravidla a sankce GDPR..."<br>
&nbsp;&nbsp;‚Ä¢ Section: "1.2.3 Sankce za poru≈°en√≠"<br>
&nbsp;&nbsp;‚Ä¢ Preceding: "[p≈ôedchoz√≠ 500 chars]"<br>
&nbsp;&nbsp;‚Ä¢ Current: "ƒål√°nek 83 stanovuje sankce..."<br>
&nbsp;&nbsp;‚Ä¢ Following: "[n√°sleduj√≠c√≠ 500 chars]"<br>
<br>
LLM ‚Üí Generated context (50-100 slov):<br>
"This section details the specific financial penalties and sanctions imposed under GDPR Article 83 for violations of data protection regulations, including both administrative fines and serious breaches."<br>
<br>
<strong>3. Embedding & Storage:</strong><br>
<strong>FOR EMBEDDING:</strong><br>
augmented = "[Generated context]\n\nƒål√°nek 83 stanovuje sankce..."<br>
<br>
<strong>FOR STORAGE:</strong><br>
stored = "ƒål√°nek 83 stanovuje sankce..." (bez context)<br>
<br>
‚Üí <strong>V√Ωhoda:</strong> Ka≈æd√Ω chunk m√° bohat√Ω kontext (doc summary + hierarchy + surrounding) ‚Üí -67% retrieval failures!
                        </div>
                    </div>

                    <span class="tag research">RCTS optimum</span>
                    <span class="tag research">-67% retrieval failures</span>
                    <span class="tag performance">3 layers</span>
                    <span class="tag">500 chars/chunk</span>
                    <span class="tag performance">LLM context (50-100 words)</span>
                    <span class="tag">Anthropic 2024</span>
                </div>
            </div>

            <div class="arrow">‚Üì</div>

            <!-- PHASE 4 -->
            <div class="phase">
                <div class="phase-header">
                    <div class="phase-number">4</div>
                    <div class="phase-title">Embedding + FAISS Indexing</div>
                    <div class="phase-timing">Fast: ~2-3min | Eco: ~20-40min</div>
                </div>
                <div class="phase-content">
                    <div class="phase-description">
                        <strong>√ökol:</strong> Vytvo≈ôit embeddingy pro v≈°echny 3 vrstvy chunk≈Ø a ulo≈æit je do 3 separ√°tn√≠ch FAISS index≈Ø. Embeddingy obsahuj√≠ <span class="highlight">context + raw_content</span>, ale ukl√°d√° se pouze raw_content.
                    </div>
                    <div class="phase-details">
                        <div class="detail-item">
                            <div class="detail-label">ü§ñ Model (cloud)</div>
                            <div class="detail-value">text-embedding-3-large (3072D)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üíª Model (lok√°ln√≠)</div>
                            <div class="detail-value">bge-m3 (1024D, free, GPU)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üóÑÔ∏è Index typ</div>
                            <div class="detail-value">FAISS IndexFlatIP (cosine similarity)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìä Poƒçet index≈Ø</div>
                            <div class="detail-value">3 separ√°tn√≠ (L1, L2, L3)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üíæ Batch size</div>
                            <div class="detail-value">100 (cloud) / 32 (local)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üìÑ Implementace</div>
                            <div class="detail-value"><span class="detail-code">src/embedding_generator.py<br>src/faiss_vector_store.py</span></div>
                        </div>
                    </div>

                    <div class="research-note">
                        <div class="research-note-title">üî¨ Context-aware embeddings (Anthropic 2024):</div>
                        <div class="research-note-content">
                            <strong>Key insight:</strong> Embedduj <code>context + raw_content</code>, ale ukl√°dej pouze <code>raw_content</code>!<br>
                            <br>
                            <strong>Proƒç?</strong><br>
                            ‚Ä¢ Embedding f√°ze: Context pom√°h√° modelu pochopit s√©mantiku chunku (SAC summary)<br>
                            ‚Ä¢ Retrieval f√°ze: LLM dostane pouze raw_content (bez redundantn√≠ho kontextu)<br>
                            ‚Ä¢ V√Ωsledek: Lep≈°√≠ embeddingy, ƒçist≈°√≠ LLM kontext, ≈æ√°dn√° duplicita<br>
                            <br>
                            <strong>3 separ√°tn√≠ indexy:</strong> M√≠sto 1 merge index pou≈æ√≠v√°me 3 specializovan√© indexy ‚Üí hierarchical search dok√°≈æe vybrat spr√°vnou vrstvu podle typu dotazu.
                        </div>
                    </div>

                    <div class="data-flow">
                        <div class="data-flow-title">üì¶ Datov√Ω tok (embedding):</div>
                        <div class="data-flow-content">
SAC chunks ‚Üí Embedding Generator ‚Üí 3 FAISS indexes:<br>
<br>
FOR KA≈ΩD√ù chunk (L1/L2/L3):<br>
&nbsp;&nbsp;embedding_input = doc_summary + "\n\n" + chunk_content<br>
&nbsp;&nbsp;vector = embed_model(embedding_input)  # 3072D nebo 1024D<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;faiss_index[layer].add(vector)<br>
&nbsp;&nbsp;metadata_store[chunk_id] = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;"raw_content": chunk_content,  # ‚Üê BEZ summary!<br>
&nbsp;&nbsp;&nbsp;&nbsp;"doc_id": "...",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"section_id": "..."<br>
&nbsp;&nbsp;}
                        </div>
                    </div>

                    <span class="tag">3072D embeddings</span>
                    <span class="tag performance">3 FAISS indexes</span>
                    <span class="tag research">Context-aware</span>
                    <span class="tag">Batch processing</span>
                </div>
            </div>

            <div class="arrow">‚Üì</div>

            <!-- PHASE 5 -->
            <div class="phase">
                <div class="phase-header">
                    <div class="phase-number">5</div>
                    <div class="phase-title">Advanced Retrieval Setup</div>
                    <div class="phase-timing">~5-15s (setup only)</div>
                </div>
                <div class="phase-content">
                    <div class="phase-description">
                        <strong>√ökol:</strong> P≈ôipravit 3 pokroƒçil√© retrieval komponenty, kter√© se pou≈æij√≠ p≈ôi search (Phase 7). Tato f√°ze pouze inicializuje struktury - skuteƒçn√© vyhled√°v√°n√≠ prob√≠h√° a≈æ p≈ôi user query.
                    </div>

                    <div class="sub-phases">
                        <div class="sub-phase">
                            <div class="sub-phase-title">5A: Knowledge Graph Construction</div>
                            <div class="sub-phase-desc">
                                <strong>√ökol:</strong> Extrahovat entity (osoby, organizace, m√≠sta, data, ƒç√°stky...) a vztahy (18 typ≈Ø) z dokument≈Ø a vytvo≈ôit graf.<br>
                                <br>
                                <strong>Metoda:</strong> LLM-based entity extraction (GPT-5-nano nebo Claude Haiku) + NetworkX/Neo4j storage<br>
                                <strong>Entity types:</strong> PERSON, ORG, LOCATION, DATE, MONEY, LAW, REGULATION, ...<br>
                                <strong>Relationship types:</strong> REFERS_TO, AMENDS, SUPERSEDES, REQUIRES, ...<br>
                                <strong>Vyu≈æit√≠:</strong> Multi-hop queries, entity-based filtering, relationship traversal<br>
                                <br>
                                <strong>Implementace:</strong> <span class="detail-code">src/graph/</span>, <span class="detail-code">src/graph_retrieval.py</span><br>
                                <strong>Konfigurace:</strong> <span class="detail-code">ENABLE_KNOWLEDGE_GRAPH=true</span>
                            </div>
                        </div>

                        <div class="sub-phase">
                            <div class="sub-phase-title">5B: Hybrid Search Initialization (BM25 + Dense + RRF)</div>
                            <div class="sub-phase-desc">
                                <strong>√ökol:</strong> P≈ôipravit BM25 index pro lexik√°ln√≠ vyhled√°v√°n√≠ a RRF fusion mechanismus.<br>
                                <br>
                                <strong>Komponenty:</strong><br>
                                ‚Ä¢ <strong>BM25 (lexical):</strong> Keyword-based search (exact matches, acronyms) - index se vytvo≈ô√≠ z chunk text≈Ø<br>
                                ‚Ä¢ <strong>Dense (semantic):</strong> FAISS embedding search (s√©mantick√© podobnosti) - u≈æ m√°me z Phase 4<br>
                                ‚Ä¢ <strong>RRF (Reciprocal Rank Fusion):</strong> Kombinuje BM25 + Dense score lists ‚Üí hybrid ranking<br>
                                <br>
                                <strong>V√Ωhoda:</strong> BM25 najde "GDPR", Dense najde "ochrana osobn√≠ch √∫daj≈Ø" ‚Üí RRF spoj√≠ oba v√Ωsledky ‚Üí +23% precision<br>
                                <strong>Parametry:</strong> RRF k=60 (research-optimal)<br>
                                <br>
                                <strong>Implementace:</strong> <span class="detail-code">src/hybrid_search.py</span>
                            </div>
                        </div>

                        <div class="sub-phase">
                            <div class="sub-phase-title">5C: Reranker Loading (Cross-encoder)</div>
                            <div class="sub-phase-desc">
                                <strong>√ökol:</strong> Naƒç√≠st cross-encoder reranker model pro 2-stage retrieval.<br>
                                <br>
                                <strong>2-stage retrieval:</strong><br>
                                1. <strong>Stage 1 (fast):</strong> Hybrid search vr√°t√≠ top-100 candidates (~200ms)<br>
                                2. <strong>Stage 2 (quality):</strong> Cross-encoder p≈ôehodnot√≠ v≈°echny p√°ry (query, chunk) a vybere top-k (~300ms)<br>
                                <br>
                                <strong>Modely:</strong> ms-marco-MiniLM, bge-reranker-large<br>
                                <strong>V√Ωhoda:</strong> +25% accuracy oproti pure hybrid search<br>
                                <strong>D≈ÆLE≈ΩIT√â:</strong> ‚ùå NEPOU≈Ω√çVAT Cohere reranker! (hor≈°√≠ v√Ωsledky na pr√°vn√≠ch dokumentech podle LegalBench-RAG)<br>
                                <br>
                                <strong>Implementace:</strong> <span class="detail-code">src/reranker.py</span>
                            </div>
                        </div>
                    </div>

                    <div class="data-flow">
                        <div class="data-flow-title">üì¶ V√Ωstup Phase 5:</div>
                        <div class="data-flow-content">
‚úÖ Knowledge Graph: NetworkX/Neo4j instance s entitami a vztahy<br>
‚úÖ BM25 Index: Rank-BM25 index pro lexik√°ln√≠ search<br>
‚úÖ Reranker Model: Cross-encoder (ms-marco nebo bge-reranker)<br>
‚úÖ HybridVectorStore: Wrapper spojuj√≠c√≠ FAISS + BM25 + Reranker<br>
<br>
‚Üí P≈ôipraveno pro user queries v Phase 7!
                        </div>
                    </div>

                    <span class="tag performance">+23% precision (hybrid)</span>
                    <span class="tag performance">+25% accuracy (reranker)</span>
                    <span class="tag">Knowledge graph</span>
                    <span class="tag research">2-stage retrieval</span>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value">5</div>
                <div class="stat-label">F√°z√≠ indexingu</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">FAISS indexy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">500</div>
                <div class="stat-label">Znak≈Ø/chunk (RCTS)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">-58%</div>
                <div class="stat-label">DRM redukce (SAC)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">+23%</div>
                <div class="stat-label">Precision (Hybrid)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">+25%</div>
                <div class="stat-label">Accuracy (Reranker)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2-3min</div>
                <div class="stat-label">Indexing (Fast mode)</div>
            </div>
        </div>
    </div>
</body>
</html>